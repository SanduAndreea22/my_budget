{% extends "base.html" %}
{% load humanize %}
{% block title %}Transactions ¬∑ MyBudget{% endblock %}

{% block content %}
<section class="glass-card" style="padding:22px;position:relative;overflow:hidden;">

  <div style="
    position:absolute; inset:-160px -220px auto auto;
    width:520px;height:520px;border-radius:999px;
    background: radial-gradient(circle at 30% 30%, rgba(99,102,241,.55), transparent 60%),
                radial-gradient(circle at 70% 70%, rgba(236,72,153,.40), transparent 60%);
    filter: blur(18px);
    opacity:.7;
    pointer-events:none;"></div>

  <div style="position:relative;">
    <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap;">
      <div>
        <h1 style="margin:0;font-size:34px;letter-spacing:-.03em;">Transactions</h1>
        <p class="muted" style="margin:6px 0 0;">Filter, edit and delete your transactions.</p>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <a class="btn btn--ghost" href="{% url 'dashboard' %}">‚Üê Dashboard</a>
        <a class="btn" href="{% url 'add_income' %}">+ Income</a>
        <a class="btn btn--ghost" href="{% url 'add_expense' %}">- Expense</a>
      </div>
    </div>

    <!-- Totals -->
    <div style="margin-top:16px;display:grid;grid-template-columns:repeat(3,1fr);gap:12px;">
      <div class="glass-card" style="padding:14px;">
        <div class="muted">Income</div>
        <div style="font-weight:950;font-size:22px;">
          {{ total_income|floatformat:2|intcomma }} {{ currency }}
        </div>
      </div>

      <div class="glass-card" style="padding:14px;">
        <div class="muted">Expense</div>
        <div style="font-weight:950;font-size:22px;">
          {{ total_expense|floatformat:2|intcomma }} {{ currency }}
        </div>
      </div>

      <div class="glass-card" style="padding:14px;">
        <div class="muted">Balance</div>
        <div style="font-weight:950;font-size:22px;color:{% if balance >= 0 %}#22c55e{% else %}#ef4444{% endif %};">
          {{ balance|floatformat:2|intcomma }} {{ currency }}
        </div>
      </div>
    </div>

    <!-- Filters -->
    <form method="GET" class="glass-card" style="margin-top:14px;padding:14px;display:grid;gap:12px;">
      <div style="display:grid;grid-template-columns: 1fr 1fr 1fr 1fr;gap:12px;">
        <div style="display:grid;gap:6px;">
          <label style="font-weight:900;color:rgba(255,255,255,.86);">Type</label>
          <select name="type">
            <option value="">All</option>
            <option value="income" {% if filters.type == "income" %}selected{% endif %}>Income</option>
            <option value="expense" {% if filters.type == "expense" %}selected{% endif %}>Expense</option>
          </select>
        </div>

        <div style="display:grid;gap:6px;">
          <label style="font-weight:900;color:rgba(255,255,255,.86);">Category</label>
          <select name="category">
            <option value="">All</option>
            {% for c in categories %}
              <option value="{{ c.id }}" {% if filters.category == c.id|stringformat:"s" %}selected{% endif %}>
                {{ c.icon|default:"üè∑Ô∏è" }} {{ c.name }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div style="display:grid;gap:6px;">
          <label style="font-weight:900;color:rgba(255,255,255,.86);">From</label>
          <input type="date" name="from" value="{{ filters.from }}">
        </div>

        <div style="display:grid;gap:6px;">
          <label style="font-weight:900;color:rgba(255,255,255,.86);">To</label>
          <input type="date" name="to" value="{{ filters.to }}">
        </div>
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <button class="btn" type="submit">Apply filters ‚Üí</button>
        <a class="btn btn--ghost" href="{% url 'transactions' %}">Reset</a>
      </div>

      <style>
        input, select{
          width:100%;
          padding:12px 12px;
          border-radius:16px;
          border:1px solid rgba(255,255,255,.16);
          background: rgba(10,12,24,.55);
          color: rgba(255,255,255,.92);
          outline:none;
          box-shadow: 0 16px 40px rgba(0,0,0,.18);
        }
        input:focus, select:focus{
          box-shadow: 0 0 0 4px rgba(99,102,241,.28), 0 18px 55px rgba(0,0,0,.25);
          border-color: rgba(99,102,241,.45);
        }
        select option{ background:#0b102a; color:#fff; }
        @media(max-width:980px){
          form .glass-card div[style*="grid-template-columns"]{grid-template-columns:1fr !important;}
        }
      </style>
    </form>

    <!-- List -->
    <div style="margin-top:14px;display:grid;gap:10px;">
      {% for t in transactions %}
        <div class="glass-card" style="padding:14px;display:flex;justify-content:space-between;align-items:center;gap:12px;">
          <div style="min-width:0;">
            <div style="font-weight:950;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
              {{ t.category.icon|default:"üè∑Ô∏è" }} {{ t.category.name }}
            </div>
            <div class="muted" style="font-size:13px;">
              {{ t.date|date:"M d, Y" }}{% if t.note %} ¬∑ {{ t.note }}{% endif %}
            </div>
          </div>

          <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:flex-end;">
            <div style="font-weight:950;color:{% if t.type == 'income' %}#22c55e{% else %}#ef4444{% endif %};">
              {% if t.type == 'income' %}+{% else %}-{% endif %}
              {{ t.amount|floatformat:2|intcomma }} {{ currency }}
            </div>

            <a class="btn btn--ghost" href="{% url 'transaction_edit' t.id %}">Edit</a>
            <a class="btn btn--ghost" href="{% url 'transaction_delete' t.id %}" style="border-color: rgba(236,72,153,.25);">
              Delete
            </a>
          </div>
        </div>
      {% empty %}
        <div class="muted">No transactions found for these filters.</div>
      {% endfor %}
    </div>

  </div>

  <style>
    @media(max-width:900px){
      div[style*="grid-template-columns:repeat(3"]{grid-template-columns:1fr !important;}
    }
  </style>
</section>
{% endblock %}
